# Nixpacks config for Santos Store (Next.js)
# better-sqlite3 needs python + gcc to compile its native addon

# Disable Docker cache mounts to avoid stale webpack data
cacheDirectories = []

[phases.setup]
nixPkgs = ["python3", "gcc", "gnumake", "nodejs_20"]

[phases.install]
cmds = ["npm ci", "npm rebuild better-sqlite3 --build-from-source"]

[phases.build]
cmds = ["echo '=== DEBUG: listing lib/ and styles/ ===' && ls -la lib/ && ls -la styles/", "NODE_ENV=production npm run build", "mkdir -p uploads", "mkdir -p data"]

[start]
cmd = "npm run start"
